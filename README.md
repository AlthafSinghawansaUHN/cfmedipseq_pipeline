# cfmedipseq_pipeline
Post-processing pipeline for next-generation circulating methylome data generated by cfMeDIP-seq

## Dependencies

The only up-front dependency is Anaconda.

Key Anaconda package dependencies:

- pyyaml
- snakemake (bioconda)
- picard (bioconda)

Example environment is provided as conda_env.yaml

If MeDEStrand or ConsensusCruncher ectract barcodes, is to be run, it must be installed separately and a reference path is required in the config.yml file.

## Snakemake profiles

For a guide on how to run a Snakemake for your cluster, see [https://www.sichong.site/2020/02/25/snakemake-and-slurm-how-to-manage-workflow-with-resource-constraint-on-hpc/](https://www.sichong.site/workflow/2019/10/17/how-to-run-snakemake-pipeline-on-hpc.html)

If this is not possible, you can also create a profile method of running snakemake. Create and place the config.yaml file in your directory within /cluster/home/username/.config/snakemake/slurm, to act as a profile, example config.yaml is provided as slurm/config.yaml if using this method. 

Additionally, create a slurm_log directory when running snakemake to place log files based on the out location of the config.yaml.

# Running

To run the pipeline you must activate a base conda environment containing the key anaconda dependencies, this is stored under the name "pipeline-cfMeDIP-core", if you want to use the same name and environement it can be done so by installing that environment using the following while in the install location

```
$ conda activate base
$ mamba env create --file conda_env.yaml
```

The launch.sh and set environment bash files sources conda to activate this using the env.sh bash file, so if you need to change path dependencies and names edit those files

Remember to edit the config.yml file so that it references your paths, documents, and settings, and to edit the default .sh files in the main directory to reference your files, email, and cluster setup.

Prior to running will require setting of environments on SLURM with `bash set_environment.sh`

To run the pipeline on SLURM using the default profile I provided and if setup correctly, submit the launch.sh file with `sbatch launch.sh`.

If profile was not setup, utilize the commented out snakemake command in launch.sh as a template for creating your own snakemake default submission.
